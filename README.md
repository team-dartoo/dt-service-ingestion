# Dartoo â€“ Ingestion Service

Dartoo í”„ë¡œì íŠ¸ì˜ **Ingestion Service**ëŠ” DART Open APIì—ì„œ ê³µì‹œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ì²˜ë¦¬í•˜ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

---

## 1. ì„œë¹„ìŠ¤ ëª©ì 

### 1.1 í•µì‹¬ ëª©ì 

Ingestion ServiceëŠ” **DART ê³µì‹œ ë°ì´í„°ì˜ ìˆ˜ì§‘, ì €ì¥, ì „ë‹¬ íŒŒì´í”„ë¼ì¸**ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ingestion Service í•µì‹¬ ëª©ì                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. ê³µì‹œ ë°ì´í„° ìˆ˜ì§‘ (Producer)                                       â”‚
â”‚     â€¢ DART Open API ì£¼ê¸°ì  í´ë§                                      â”‚
â”‚     â€¢ ê³µì‹œ ì›ë¬¸(ZIP) ë‹¤ìš´ë¡œë“œ                                         â”‚
â”‚     â€¢ ì½˜í…ì¸  ì •ê·œí™” (ì¸ì½”ë”© ë³€í™˜, í˜•ì‹ ì²˜ë¦¬)                           â”‚
â”‚                                                                      â”‚
â”‚  2. ì›ë¬¸ íŒŒì¼ ì €ì¥                                                   â”‚
â”‚     â€¢ MinIO ê°ì²´ ìŠ¤í† ë¦¬ì§€ì— HTML/XML íŒŒì¼ ì—…ë¡œë“œ                       â”‚
â”‚     â€¢ ë‚ ì§œë³„ í´ë” êµ¬ì¡° (YYYYMMDD/rcept_no.html)                       â”‚
â”‚                                                                      â”‚
â”‚  3. ë©”íƒ€ë°ì´í„° ì „ë‹¬ (Consumer)                                        â”‚
â”‚     â€¢ RabbitMQë¥¼ í†µí•œ ë©”ì‹œì§€ ë°œí–‰/êµ¬ë…                                â”‚
â”‚     â€¢ Disclosure Service API í˜¸ì¶œë¡œ ë©”íƒ€ë°ì´í„° ì €ì¥                   â”‚
â”‚                                                                      â”‚
â”‚  4. (í–¥í›„) Presigned URL ìƒì„±                                        â”‚
â”‚     â€¢ Summary Worker, í´ë¼ì´ì–¸íŠ¸ë¥¼ ìœ„í•œ ì„ì‹œ ë‹¤ìš´ë¡œë“œ URL ìƒì„±          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ì„œë¹„ìŠ¤ êµ¬ì„±

| ì»´í¬ë„ŒíŠ¸ | ì—­í•  | ê¸°ìˆ  |
|----------|------|------|
| **Producer** | DART API í´ë§, MinIO ì €ì¥, ë©”ì‹œì§€ ë°œí–‰ | Python ìŠ¤í¬ë¦½íŠ¸ |
| **Consumer** | ë©”ì‹œì§€ ìˆ˜ì‹ , Disclosure Service API í˜¸ì¶œ | Celery Worker |
| **RabbitMQ** | ë©”ì‹œì§€ ë¸Œë¡œì»¤ | AMQP |
| **MinIO** | ê³µì‹œ ì›ë¬¸ íŒŒì¼ ì €ì¥ | S3 í˜¸í™˜ ìŠ¤í† ë¦¬ì§€ |

### 1.3 ì„¤ê³„ ì›ì¹™

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **Producer-Consumer ë¶„ë¦¬** | ìˆ˜ì§‘(Producer)ê³¼ ì „ë‹¬(Consumer) ì—­í•  ë¶„ë¦¬ |
| **ë‚´ê²°í•¨ì„±** | ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„, ì˜êµ¬ ì‹¤íŒ¨ ê¸°ë¡ |
| **ì¤‘ë³µ ë°©ì§€** | ì´ë¯¸ ì²˜ë¦¬ëœ ê³µì‹œ ìë™ ìŠ¤í‚µ |
| **ë¹„ë™ê¸° ì²˜ë¦¬** | Celeryë¥¼ í†µí•œ ë¹„ë™ê¸° ë©”ì‹œì§€ ì²˜ë¦¬ |

---

## 2. ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  | ë²„ì „ | ë¹„ê³  |
|------|------|------|------|
| **ì–¸ì–´** | Python | 3.11+ | - |
| **íƒœìŠ¤í¬ í** | Celery | 5.3.4 | ë©”ì‹œì§€ ë°œí–‰/êµ¬ë… |
| **ë©”ì‹œì§€ ë¸Œë¡œì»¤** | RabbitMQ | 4+ | AMQP í”„ë¡œí† ì½œ |
| **ê°ì²´ ìŠ¤í† ë¦¬ì§€** | MinIO | Latest | S3 í˜¸í™˜ API |
| **HTTP í´ë¼ì´ì–¸íŠ¸** | requests, httpx | - | DART API, Disclosure API í˜¸ì¶œ |
| **ì»¨í…Œì´ë„ˆ** | Docker | 24+ | - |

> **ì°¸ê³ **: Ingestion ServiceëŠ” FastAPIë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ProducerëŠ” ìˆœìˆ˜ Python ìŠ¤í¬ë¦½íŠ¸ì´ê³ , ConsumerëŠ” Celery Workerì…ë‹ˆë‹¤.

---

## 3. ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Ingestion Service                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                          Producer                                    â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚   â”‚   â”‚ DART API    â”‚   â”‚  Content    â”‚   â”‚   MinIO     â”‚              â”‚   â”‚
â”‚   â”‚   â”‚ Client      â”‚â”€â”€â–¶â”‚  Normalizer â”‚â”€â”€â–¶â”‚   Upload    â”‚              â”‚   â”‚
â”‚   â”‚   â”‚             â”‚   â”‚             â”‚   â”‚             â”‚              â”‚   â”‚
â”‚   â”‚   â”‚ â€¢ ëª©ë¡ ì¡°íšŒ  â”‚   â”‚ â€¢ ZIP í•´ì œ   â”‚   â”‚ â€¢ íŒŒì¼ ì €ì¥  â”‚              â”‚   â”‚
â”‚   â”‚   â”‚ â€¢ ì›ë¬¸ ë‹¤ìš´  â”‚   â”‚ â€¢ ì¸ì½”ë”© ë³€í™˜â”‚   â”‚ â€¢ ê²½ë¡œ ìƒì„±  â”‚              â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚   â”‚                                              â”‚                       â”‚   â”‚
â”‚   â”‚                                              â–¼                       â”‚   â”‚
â”‚   â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚                                       â”‚   Celery    â”‚               â”‚   â”‚
â”‚   â”‚                                       â”‚   Publish   â”‚               â”‚   â”‚
â”‚   â”‚                                       â”‚             â”‚               â”‚   â”‚
â”‚   â”‚                                       â”‚ ë©”íƒ€ë°ì´í„°    â”‚               â”‚   â”‚
â”‚   â”‚                                       â”‚ ë©”ì‹œì§€ ë°œí–‰   â”‚               â”‚   â”‚
â”‚   â”‚                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚                          â”‚
â”‚                                                  â–¼                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                         RabbitMQ                                      â”‚  â”‚
â”‚   â”‚                    (celery default queue)                             â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   Message: {corp_code, corp_name, rcept_no, object_key, ...}         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚                          â”‚
â”‚                                                  â–¼                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                          Consumer                                     â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚   â”‚   â”‚  Celery     â”‚   â”‚   HTTP      â”‚   â”‚  Disclosure Service        â”‚â”‚  â”‚
â”‚   â”‚   â”‚  Worker     â”‚â”€â”€â–¶â”‚   Client    â”‚â”€â”€â–¶â”‚  PUT /api/v1/disclosures/  â”‚â”‚  â”‚
â”‚   â”‚   â”‚             â”‚   â”‚             â”‚   â”‚                             â”‚â”‚  â”‚
â”‚   â”‚   â”‚ ë©”ì‹œì§€ ìˆ˜ì‹   â”‚   â”‚ ì¬ì‹œë„ ë¡œì§  â”‚   â”‚  ë©”íƒ€ë°ì´í„° ì €ì¥             â”‚â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì™¸ë¶€ ì˜ì¡´ì„±:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DART API   â”‚     â”‚   MinIO     â”‚     â”‚ Disclosure Service  â”‚
â”‚ (ê¸ˆìœµê°ë…ì›) â”‚     â”‚  (Storage)  â”‚     â”‚     (FastAPI)       â”‚
â”‚             â”‚     â”‚             â”‚     â”‚                     â”‚
â”‚ â€¢ list.json â”‚     â”‚ â€¢ ì›ë¬¸ ì €ì¥  â”‚     â”‚ â€¢ ë©”íƒ€ë°ì´í„° ì €ì¥    â”‚
â”‚ â€¢ document  â”‚     â”‚ â€¢ URL ìƒì„±  â”‚     â”‚ â€¢ ê²€ìƒ‰ API ì œê³µ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ë°ì´í„° íë¦„

### 4.1 ê³µì‹œ ìˆ˜ì§‘ íë¦„ (Producer)

```
1. DART API í´ë§
   â””â”€ DartApiClient.fetch_disclosures(date)
      â””â”€ ì‘ë‹µ: ê³µì‹œ ëª©ë¡ (list.json)
      
2. ê° ê³µì‹œì— ëŒ€í•´:
   â”‚
   â”œâ”€ (a) ì¤‘ë³µ í™•ì¸
   â”‚      â””â”€ PROCESSED_RCEPT_NOS ì§‘í•© í™•ì¸
   â”‚      â””â”€ MinIO ì¡´ì¬ ì—¬ë¶€ í™•ì¸
   â”‚
   â”œâ”€ (b) ì›ë¬¸ ë‹¤ìš´ë¡œë“œ
   â”‚      â””â”€ DartApiClient.fetch_document_content(rcept_no)
   â”‚      â””â”€ ì‘ë‹µ: ZIP íŒŒì¼
   â”‚
   â”œâ”€ (c) ì½˜í…ì¸  ì •ê·œí™”
   â”‚      â””â”€ normalize_payload(zip_bytes)
   â”‚      â””â”€ ZIP í•´ì œ â†’ ì¸ì½”ë”© ë³€í™˜ â†’ UTF-8 HTML/XML
   â”‚
   â”œâ”€ (d) MinIO ì—…ë¡œë“œ
   â”‚      â””â”€ MinIOClient.upload_document(object_name, content)
   â”‚      â””â”€ ê²½ë¡œ: {rcept_dt}/{rcept_no}.html
   â”‚
   â””â”€ (e) Celery ë©”ì‹œì§€ ë°œí–‰
          â””â”€ celery_app.send_task("tasks.process_disclosure", kwargs=message)
```

### 4.2 ë©”íƒ€ë°ì´í„° ì „ë‹¬ íë¦„ (Consumer)

```
1. RabbitMQ ë©”ì‹œì§€ ìˆ˜ì‹ 
   â””â”€ process_disclosure(**kwargs)
   
2. ë©”ì‹œì§€ ë³€í™˜
   â””â”€ object_key â†’ minio_object_name
   â””â”€ metadata ì¶”ê°€ (polling_date, source)
   
3. Disclosure Service API í˜¸ì¶œ
   â””â”€ PUT /api/v1/disclosures/{rcept_no}
   â””â”€ í—¤ë”: X-Worker-Api-Key
   
4. ê²°ê³¼ ì²˜ë¦¬
   â”œâ”€ ì„±ê³µ: ë¡œê·¸ ê¸°ë¡ + ACK
   â”œâ”€ 4xx ì˜¤ë¥˜: ì¬ì‹œë„ ì—†ì´ ì‹¤íŒ¨ ì²˜ë¦¬
   â””â”€ 5xx ì˜¤ë¥˜: Celery ìë™ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)
```

### 4.3 ë©”ì‹œì§€ ìŠ¤í‚¤ë§ˆ

**Producer â†’ Consumer ë©”ì‹œì§€:**
```json
{
  "corp_code": "00126380",
  "corp_name": "ì‚¼ì„±ì „ì",
  "stock_code": "005930",
  "corp_cls": "Y",
  "report_nm": "ì‚¬ì—…ë³´ê³ ì„œ",
  "rcept_no": "20241125000001",
  "flr_nm": "ì‚¼ì„±ì „ì",
  "rcept_dt": "20241125",
  "rm": null,
  "object_key": "20241125/20241125000001.html",
  "content_type": "text/html; charset=UTF-8",
  "file_size": 123456,
  "polling_date": "20241125"
}
```

**Consumer â†’ Disclosure Service API ìš”ì²­:**
```json
{
  "rcept_no": "20241125000001",
  "corp_code": "00126380",
  "corp_name": "ì‚¼ì„±ì „ì",
  "stock_code": "005930",
  "corp_cls": "Y",
  "report_nm": "ì‚¬ì—…ë³´ê³ ì„œ",
  "flr_nm": "ì‚¼ì„±ì „ì",
  "rcept_dt": "20241125",
  "rm": null,
  "minio_object_name": "20241125/20241125000001.html",
  "content_type": "text/html; charset=UTF-8",
  "file_size": 123456,
  "metadata": {
    "polling_date": "20241125",
    "source": "ingestion_service"
  }
}
```

---

## 5. ì„¤ì¹˜ ë° ì‹¤í–‰

### 5.1 ì‚¬ì „ ìš”êµ¬ì‚¬í•­

```bash
# 1. Docker ë„¤íŠ¸ì›Œí¬ ìƒì„± (ìµœì´ˆ 1íšŒ)
docker network create dt-network

# 2. DART API í‚¤ ë°œê¸‰
# https://opendart.fss.or.kr/ ì—ì„œ ë°œê¸‰
```

### 5.2 ë¹ ë¥¸ ì‹œì‘

```bash
# 1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd dt-service-ingestion

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì—ì„œ DART_API_KEY ì„¤ì • (í•„ìˆ˜!)

# 3. ì¸í”„ë¼ ë¨¼ì € ì‹¤í–‰ (RabbitMQ, MinIO)
docker-compose up -d rabbitmq minio
sleep 30  # ì¸í”„ë¼ ì¤€ë¹„ ëŒ€ê¸°

# 4. ì „ì²´ ì„œë¹„ìŠ¤ ì‹¤í–‰
docker-compose up -d

# 5. ë¡œê·¸ í™•ì¸
docker-compose logs -f producer  # ê³µì‹œ ìˆ˜ì§‘ ë¡œê·¸
docker-compose logs -f consumer  # ë©”íƒ€ë°ì´í„° ì „ì†¡ ë¡œê·¸
```

### 5.3 í™˜ê²½ ë³€ìˆ˜

| ë³€ìˆ˜ëª… | í•„ìˆ˜ | ì„¤ëª… | ê¸°ë³¸ê°’ |
|--------|------|------|--------|
| `DART_API_KEY` | âœ… | DART Open API ì¸ì¦í‚¤ (40ì) | - |
| `MINIO_ENDPOINT` | âœ… | MinIO ì—”ë“œí¬ì¸íŠ¸ | `localhost:9000` |
| `MINIO_ACCESS_KEY` | âœ… | MinIO ì ‘ê·¼ í‚¤ | - |
| `MINIO_SECRET_KEY` | âœ… | MinIO ë¹„ë°€ í‚¤ | - |
| `MINIO_BUCKET` | âŒ | ë²„í‚· ì´ë¦„ | `dart-disclosures` |
| `CELERY_BROKER_URL` | âœ… | RabbitMQ URL | - |
| `DISCLOSURE_SERVICE_URL` | âœ… | Disclosure Service URL | `http://disclosure-api:8000` |
| `WORKER_API_KEY` | âœ… | Worker ì¸ì¦ í‚¤ | - |
| `POLL_INTERVAL` | âŒ | í´ë§ ê°„ê²© (ì´ˆ) | `300` |
| `TARGET_DATE` | âŒ | íŠ¹ì • ë‚ ì§œë§Œ í´ë§ (YYYYMMDD) | (ì˜¤ëŠ˜) |
| `MAX_FAIL` | âŒ | ê³µì‹œë³„ ìµœëŒ€ ì¬ì‹œë„ | `3` |

---

## 6. ëª¨ë‹ˆí„°ë§

### 6.1 ë¡œê·¸ í™•ì¸

```bash
# Producer ë¡œê·¸ (ê³µì‹œ ìˆ˜ì§‘)
docker-compose logs -f producer | grep -E "(SUCCESS|FAILED|SKIPPED)"

# Consumer ë¡œê·¸ (ë©”íƒ€ë°ì´í„° ì „ì†¡)
docker-compose logs -f consumer | grep -E "(âœ…|âŒ|ğŸ”„)"

# ì „ì²´ ë¡œê·¸
docker-compose logs -f
```

### 6.2 RabbitMQ ê´€ë¦¬ UI

```
URL: http://localhost:15672
ID: admin
PW: password
```

í™•ì¸ í•­ëª©:
- **Queues** â†’ celery: ëŒ€ê¸° ì¤‘ì¸ ë©”ì‹œì§€ ìˆ˜
- **Connections**: Producer/Consumer ì—°ê²° ìƒíƒœ

### 6.3 MinIO ì½˜ì†”

```
URL: http://localhost:9001
ID: minioadmin
PW: minioadmin
```

í™•ì¸ í•­ëª©:
- **Buckets** â†’ dart-disclosures
- ë‚ ì§œë³„ í´ë” êµ¬ì¡° í™•ì¸

### 6.4 ì‹¤íŒ¨ ë¡œê·¸

```bash
# ì‹¤íŒ¨í•œ ê³µì‹œ ëª©ë¡
ls -la logs/failed_logs/

# íŠ¹ì • ì‹¤íŒ¨ ìƒì„¸ í™•ì¸
cat logs/failed_logs/20241125000001.json
```

---

## 7. ì—°ë™ êµ¬ì¡°

### 7.1 Disclosure Service ì—°ë™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì—°ë™ íë¦„                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Ingestion Service                    Disclosure Service        â”‚
â”‚   (Celery Worker)                      (FastAPI)                 â”‚
â”‚                                                                  â”‚
â”‚        â”‚                                      â”‚                  â”‚
â”‚        â”‚  HTTP PUT                            â”‚                  â”‚
â”‚        â”‚  /api/v1/disclosures/{rcept_no}     â”‚                  â”‚
â”‚        â”‚  Header: X-Worker-Api-Key           â”‚                  â”‚
â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
â”‚        â”‚                                      â”‚                  â”‚
â”‚        â”‚  Response: 201 Created              â”‚                  â”‚
â”‚        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â”‚        â”‚                                      â”‚                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Summary Worker ì—°ë™ (í–¥í›„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Summary Worker ì—°ë™ (í–¥í›„)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Summary Worker                       Ingestion Service         â”‚
â”‚                                        (RPC Responder)           â”‚
â”‚        â”‚                                      â”‚                  â”‚
â”‚        â”‚  RPC Request                         â”‚                  â”‚
â”‚        â”‚  "get_presigned_url"                 â”‚                  â”‚
â”‚        â”‚  {object_key, expires}               â”‚                  â”‚
â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
â”‚        â”‚                                      â”‚                  â”‚
â”‚        â”‚  RPC Response                        â”‚                  â”‚
â”‚        â”‚  {presigned_url}                     â”‚                  â”‚
â”‚        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â”‚        â”‚                                      â”‚                  â”‚
â”‚        â”‚  HTTP GET (ì›ë¬¸ ë‹¤ìš´ë¡œë“œ)              â”‚                  â”‚
â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ MinIO            â”‚
â”‚        â”‚                                      â”‚                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ë¬¸ì œ í•´ê²°

### 8.1 DART API ì˜¤ë¥˜

| ìƒíƒœ ì½”ë“œ | ì˜ë¯¸ | í•´ê²° ë°©ë²• |
|-----------|------|----------|
| `010` | ë¯¸ë“±ë¡ í‚¤ | API í‚¤ í™•ì¸ |
| `020` | ì¼ì¼ í•œë„ ì´ˆê³¼ (20,000ê±´/ì¼) | ìµì¼ê¹Œì§€ ëŒ€ê¸° |
| `013` | ë°ì´í„° ì—†ìŒ | ì •ìƒ (í•´ë‹¹ ë‚ ì§œ ê³µì‹œ ì—†ìŒ) |
| `800` | ì‹œìŠ¤í…œ ì ê²€ | 5ë¶„ í›„ ì¬ì‹œë„ |

```bash
# API í‚¤ í…ŒìŠ¤íŠ¸
curl "https://opendart.fss.or.kr/api/list.json?crtfc_key=YOUR_KEY&bgn_de=20241101&end_de=20241101"
```

### 8.2 Consumer ë¬¸ì œ

```bash
# Consumer ìƒíƒœ í™•ì¸
docker exec -it dt-consumer celery -A worker inspect active

# RabbitMQ í í™•ì¸
docker exec -it dt-rabbitmq rabbitmqctl list_queues
```

### 8.3 MinIO ë¬¸ì œ

```bash
# MinIO í—¬ìŠ¤ ì²´í¬
curl http://localhost:9000/minio/health/live

# ë²„í‚· ëª©ë¡ í™•ì¸ (MinIO CLI)
docker exec -it dt-minio mc ls local/
```

---

## 9. ì°¸ê³  ìë£Œ

- [DART Open API ê°€ì´ë“œ](https://opendart.fss.or.kr/guide/main.do)
- [Celery ë¬¸ì„œ](https://docs.celeryq.dev/)
- [MinIO Python SDK](https://min.io/docs/minio/linux/developers/python/API.html)

---
